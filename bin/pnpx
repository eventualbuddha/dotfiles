#!/bin/sh

## Try to run pnpx via npx if it's installed.
dir="${PWD}"
cli="$(basename $0)"
pkg=pnpm

while [ "${dir}" != "/" ]; do
  package_json_path=$(cd "${dir}" && ~/bin/find-up package.json)

  if [ -f "${package_json_path}" ]; then
    version=$(~/bin/json-get "devDependencies.${pkg}" < "${package_json_path}")

    if [ -n "${version}" ]; then
      exec ~/bin/npx -q --package "${pkg}" "${cli}" "$@"
    fi
  fi

  dir="$(dirname "${dir}")"
done

exec ~/bin/run-bin-with-version-file node .node-version NODE_VERSION "${pkg}" -- "$@"
